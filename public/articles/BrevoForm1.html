<!DOCTYPE html>
<html lang="en"><head>

<meta charset="utf-8"/>
<meta content="quarto-1.4.554" name="generator"/>

<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>


<title>A Simpler Newsletter Form : Creating New Contacts with Brevo.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>








<link href="./quarto_files/libs/quarto-html/quarto-syntax-highlighting.css" id="quarto-text-highlighting-styles" rel="stylesheet"/>





<link href="../img/favicon.ico" rel="icon" type="image/x-icon"/><link href="https://fonts.googleapis.com" rel="preconnect"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&amp;display=swap" rel="stylesheet"/><link as="font" crossorigin="anonymous" href="../fonts/LeMurmure-Regular.woff2" rel="preload" type="font/woff2"/><link href="../build/tailwind.css" rel="stylesheet"/><script>
                if (localStorage.getItem('dark-mode') === 'true' || (!('dark-mode' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.querySelector('html').classList.add('dark');
                } else {
                    document.querySelector('html').classList.remove('dark');
                }
            </script><meta content="Today a blog post about '“A Guide to Using Their API with Django”'" name="description"/></head>

<body class="bg-gray-100 fullContent w-screen overflow-x-hidden bg-gray-100 font-body text-gray-900 dark:bg-gray-1000 dark:text-gray-200"><nav class="fixed isolate w-52 dark:w-56 z-50 m-0 p-4 text-xl lg:m-8">
			<a class="w-full border-b inline-block border-pink-800 bg-gray-200 px-1 pb-1 pt-2 not-italic lg:bg-transparent dark:border-0 dark:bg-pink-400 dark:text-gray-1000 dark:font-black" href="https://thomasdargent.com">Thomas Dargent</a>
			<button class="-rotate-1 rotate-1 shadow-md sm:hidden w-full bg-gray-100 border border-pink-950 text-center dark:bg-gray-1000 dark:border-pink-600" id="show-btn" type="button">↧</button>
			<ul class="mt-4 *:bg-gray-200 *:lg:bg-transparent dark:*:bg-gray-1000 dark:border dark:border-pink-400 dark:[&amp;_li+li]:border-t dark:[&amp;_li+li]:border-pink-400 hidden sm:block text-base" id="menu">
				<li class="p-1">
					<a class="hover:ml-4 hover:text-pacific-blue-600 dark:hover:text-pink-400" href="https://thomasdargent.com/#portfolio">Portfolio</a>
				</li>
				<li class="p-1"><a class="hover:ml-4 hover:text-pacific-blue-600 dark:hover:text-pink-400" href="https://thomasdargent.com/#blog">Blog</a></li>
				<li class="p-1"><a class="hover:ml-4 hover:text-pacific-blue-600 dark:hover:text-pink-400" href="https://thomasdargent.com/#contact">Contact</a></li>
			</ul>
			<div class="flex flex-col justify-center mx-6 mt-2 items-center bg-gray-200 border border-pacific-blue-500 lg:border-0 dark:bg-gray-1000 lg:bg-transparent rounded-full dark:border dark:border-pink-600">
					<input class="sr-only" id="light-switch" name="light-switch" type="checkbox"/>
					<label class="relative cursor-pointer p-1 grid grid-cols-3" for="light-switch">
						<svg alt="Dark theme icon" aria-label="Switch to dark" class="dark:fill-gray-700 fill-pacific-blue-500 h-4 w-4 mt-1" role="img" viewBox="17.6262 123.819 352.1318 344.5168" xmlns="http://www.w3.org/2000/svg">
							<path d="M 205.513 205.745 C 268.065 204.767 287.003 164.344 287.789 123.819 C 287.499 164.344 301.297 205.092 369.758 205.178 C 298.116 205.93 287.767 247.714 288.352 288.239 C 288.781 247.714 268.065 203.606 205.513 205.745 Z"></path>
							<polygon points="314.275 232.401 322.389 251.392 341.325 259.057 330.842 241.397"></polygon>
							<polygon points="230.871 259.057 238.986 240.065 257.921 232.401 247.439 250.06" style="transform-origin: 244.396px 245.729px;" transform="matrix(-1, 0, 0, -1, 0, 0.000030517578)"></polygon>
							<polygon points="314.274 177.389 322.388 158.397 341.324 150.733 330.842 168.392"></polygon>
							<polygon points="230.871 150.733 238.986 169.724 257.92 177.389 247.439 159.729" style="transform-origin: 244.396px 164.061px;" transform="matrix(-1, 0, 0, -1, -0.000030517578, 0)"></polygon>
							<path d="M 162.82 155.163 C 112.361 251.928 90.773 398.67 321.209 399.04 C 141.603 595.849 -165.971 328.478 162.82 155.163 Z"></path>
						  </svg>
						  <div class="border-b border-pink-600 h-1/2 w-full"></div>
						<svg alt="Light theme icon" aria-label="Switch to light" class="dark:fill-[#FDD162] fill-gray-700 ml-2 h-6 w-6" role="img" viewBox="176.732 48.923 258.842 257.472" xmlns="http://www.w3.org/2000/svg">
							<path d="M 176.732 177.215 C 275.311 175.683 305.157 112.384 306.395 48.923 C 305.938 112.384 327.683 176.192 435.574 176.327 C 322.67 177.504 306.36 242.935 307.283 306.395 C 307.958 242.935 275.311 173.865 176.732 177.215 Z"></path>
							<polygon points="348.135 218.956 360.923 248.696 390.764 260.697 374.245 233.044"></polygon>
							<polygon points="216.696 260.697 229.484 230.957 259.325 218.956 242.806 246.609" style="transform-origin: 238.011px 239.826px;" transform="matrix(-1, 0, 0, -1, 0, 0.000030517578)"></polygon>
							<polygon points="348.134 132.81 360.922 103.07 390.763 91.069 374.244 118.722"></polygon>
							<polygon points="216.695 91.069 229.483 120.809 259.324 132.81 242.805 105.157" style="transform-origin: 238.01px 111.94px;" transform="matrix(-1, 0, 0, -1, 0, 0.000015258789)"></polygon>
						  </svg>
						<span class="sr-only">Switch to light / dark version</span>
					</label>
			</div>
		</nav>

<div class="px-6 pb-16 pt-48 sm:pt-16 lg:pt-16 sm:px-16 sm:pl-56 lg:pl-72 xl:pl-96" id="quarto-content">

<main class="content" id="quarto-document-content">

<header class="prose lg:prose-lg text-center font-normal" id="title-block-header">
<div class="quarto-title">
<h1 class="font-heading text-4xl !w-full max-w-[40rem] sm:text-6xl mb-12 mt-8 font-normal text-center dark:text-gray-100">A Simpler Newsletter Form : Creating New Contacts with Brevo.</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


<p class="prose lg:prose-lg text-xl !w-full max-w-[40rem] !mb-6 !mt-2 text-gray-900 dark:text-gray-200 text-center">— OR —</p><p class="prose lg:prose-lg text-lg !mb-16 !w-full max-w-[40rem] text-gray-900 dark:text-gray-200 text-center" role="doc-subtitle">“A Guide to Using Their API with Django”</p></header>



<section class="level2" id="wrestling-with-an-outdated-documentation">
<h2 class="text-2xl sm:text-3xl !w-full max-w-[40rem] mb-4 mt-8 font-bold text-pacific-blue-600 dark:text-pink-400" data-anchor-id="wrestling-with-an-outdated-documentation">Wrestling with an outdated documentation</h2>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">Brevo is an easy-to-use newsletter service that offers a lot of great features. There’s a free plan, pre-made templates, you can use SMS, Mail… and – more importantly – they have a nice API. But there’s a dark spot on the map. Brevo hide something. Brevo wasn’t always Brevo. Brevo swept its infancy under a rug… you see, before 2023, Brevo was… SendInBlue. Ok, jokes aside, it means that their otherwise impressive API documentation refers to an outdated SDK.</p>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">For a project, I had to implement a newsletter form so that users could join a mailing list. To better integrate it to the website, we wanted to use a custom form. Simple enough. Except the contacts’ documentation refer to a SendInBlue python SDK, and the package is <strong>complicated</strong>. I wanted to reverse engineer the SDK but it is huge, it isn’t easy to make your way through the code. Lazily, I decided to use the requests library to interact with the Brevo API directly. This tutorial describes the process.</p>
<section class="level3" id="a-fake-problem-because-of-an-inconsistency">
<h3 class="text-lg sm:text-2xl !w-full max-w-[40rem] mb-4 mt-8 font-bold text-pacific-blue-900 dark:text-pink-600" data-anchor-id="a-fake-problem-because-of-an-inconsistency">A fake problem because of an inconsistency</h3>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">While writing this I realized that the <a href="https://github.com/getbrevo/brevo-python/blob/main/docs/ContactsApi.md#add_contact_to_list">github documentation</a> of the Brevo package, linked on the new SDK page, is up-to-date. As I said, that is not the case of the <a href="https://developers.brevo.com/reference/createcontact">API documentation of their website</a>, which refers to a SendInBlue GitHub profile. Nevermind, let’s just say this article might help people that were as lost as me find their way between both !</p>
</section>
</section>
<section class="level2" id="what-to-expect-in-this-series">
<h2 class="text-2xl sm:text-3xl !w-full max-w-[40rem] mb-4 mt-8 font-bold text-pacific-blue-600 dark:text-pink-400" data-anchor-id="what-to-expect-in-this-series">What to expect in this series</h2>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">This first part will only focus on making your API with. The next one will describe the front end implementation with HTMX, as a bonus. Finally I will write an article on how you can add a custom captcha to the form (or any form, for that matter).</p>
</section>
<section class="level2" id="adding-a-contact-to-a-brevo-list">
<h2 class="text-2xl sm:text-3xl !w-full max-w-[40rem] mb-4 mt-8 font-bold text-pacific-blue-600 dark:text-pink-400" data-anchor-id="adding-a-contact-to-a-brevo-list">Adding a contact to a Brevo list</h2>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4"><img alt="File architecture in our Django folders" class="shadow-punk border border-gray-900 p-2 shadow-gray-900 bg-gray-200 !mt-8 !mb-10 dark:shadow-gray-700 dark:border-gray-700" src="img/BrevoForm1_Architecture.svg?as=webp"/> In our views.py file, we’ll first get the POST data we need.</p>
<div class="code-with-filename mt-4">
<div class="code-with-filename-file bg-gray-900 inline-block text-gray-100 dark:bg-gray-200 dark:text-gray-900 py-1 px-2 -rotate-3">
<pre style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><strong>views.py</strong></pre>
</div>
<div class="sourceCode !mt-0  overflow-auto !max-w-[40rem] bg-gray-900 dark:bg-gray-1000 text-sm lg:text-base mb-8 p-2 py-4 shadow-gray-1000 dark:shadow-gray-700 shadow-punk border border-gray-900 dark:border-gray-700" data-filename="views.py" id="cb1"><pre class="sourceCode python code-with-copy" style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><code class="sourceCode python"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1" tabindex="-1"></a><span class="kw">def</span> brevo_handler(request):</span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2" tabindex="-1"></a>    <span class="co"># Extracting the posted data from the request</span></span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3" tabindex="-1"></a>    email <span class="op">=</span> request.POST.get(<span class="st">"email"</span>)</span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4" tabindex="-1"></a>    last_name <span class="op">=</span> request.POST.get(<span class="st">"last_name"</span>)</span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5" tabindex="-1"></a>    first_name <span class="op">=</span> request.POST.get(<span class="st">"first_name"</span>)</span>
<span id="cb1-6"><a aria-hidden="true" href="#cb1-6" tabindex="-1"></a>    captcha_code <span class="op">=</span> request.POST.get(<span class="st">"captcha"</span>)</span></code></pre></div>
</div>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">We then use the data we got to construct our request. <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">email</code> is a basic field, but all the others needs to be in an <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">attributes</code> dict. All optional field needs to be written in full caps.</p>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">You can send your contacts as such, but you usually want them in a list, to have a better control on who you send your newsletter to. As such, you need to add a field to the dict containing a list of <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">int</code> (you can send the contact to multiple lists as one). The list Id can be found on the main Brevo website after a <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">#</code>. Sorry for the french interface, here the listId is 2 (which seems to be the default starting Id). <img alt="Sorry for the french. Here the listId is 2" class="shadow-punk border border-gray-900 p-2 shadow-gray-900 bg-gray-200 !mt-8 !mb-10 dark:shadow-gray-700 dark:border-gray-700" src="./img/brevo_list.png?as=webp"/></p>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">To send contacts to Brevo, they need to make sure we are the right person, otherwise anyone could spam our contact list. To do that, it gives use a secret key, called the API key. It’s super easy to get, and <a href="https://help.brevo.com/hc/fr/articles/209467485-Cr%C3%A9er-ou-supprimer-une-cl%C3%A9-API#heading-3">Brevo explains it well</a>. We also need to send the dict as json, and tell it so.</p>
<div class="code-with-filename mt-4">
<div class="code-with-filename-file bg-gray-900 inline-block text-gray-100 dark:bg-gray-200 dark:text-gray-900 py-1 px-2 -rotate-3">
<pre style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><strong>views.py</strong></pre>
</div>
<div class="sourceCode !mt-0  overflow-auto !max-w-[40rem] bg-gray-900 dark:bg-gray-1000 text-sm lg:text-base mb-8 p-2 py-4 shadow-gray-1000 dark:shadow-gray-700 shadow-punk border border-gray-900 dark:border-gray-700" data-filename="views.py" id="cb2"><pre class="sourceCode python code-with-copy" style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><code class="sourceCode python"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> brevo_handler(request):</span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a>    <span class="co">#...</span></span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3" tabindex="-1"></a>    <span class="co"># Constructing the Brevo API request payload with the posted data</span></span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4" tabindex="-1"></a>    obj <span class="op">=</span> {</span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5" tabindex="-1"></a>        <span class="st">"email"</span>: email,</span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6" tabindex="-1"></a>        <span class="st">"attributes"</span>: {</span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7" tabindex="-1"></a>            <span class="st">"LNAME"</span>: last_name,</span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8" tabindex="-1"></a>            <span class="st">"FNAME"</span>: first_name,</span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9" tabindex="-1"></a>        },</span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10" tabindex="-1"></a>    }</span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11" tabindex="-1"></a>    <span class="cf">if</span> BREVO_LIST <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12" tabindex="-1"></a>        obj[<span class="st">"listIds"</span>] <span class="op">=</span> [<span class="bu">int</span>(BREVO_LIST),]</span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14" tabindex="-1"></a>        <span class="st">"api-key"</span>: BREVO_API_KEY,</span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15" tabindex="-1"></a>        <span class="st">"accept"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb2-16"><a aria-hidden="true" href="#cb2-16" tabindex="-1"></a>        <span class="st">"content-type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb2-17"><a aria-hidden="true" href="#cb2-17" tabindex="-1"></a>    }</span></code></pre></div>
</div>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">The payload can now be sent in a POST request to Brevo.</p>
<div class="code-with-filename mt-4">
<div class="code-with-filename-file bg-gray-900 inline-block text-gray-100 dark:bg-gray-200 dark:text-gray-900 py-1 px-2 -rotate-3">
<pre style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><strong>views.py</strong></pre>
</div>
<div class="sourceCode !mt-0  overflow-auto !max-w-[40rem] bg-gray-900 dark:bg-gray-1000 text-sm lg:text-base mb-8 p-2 py-4 shadow-gray-1000 dark:shadow-gray-700 shadow-punk border border-gray-900 dark:border-gray-700" data-filename="views.py" id="cb3"><pre class="sourceCode python code-with-copy" style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><code class="sourceCode python"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1" tabindex="-1"></a><span class="kw">def</span> brevo_handler(request):</span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a>    <span class="co">#...</span></span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a>    response <span class="op">=</span> requests.post(BREVO_URL, json<span class="op">=</span>obj, headers<span class="op">=</span>headers)</span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a aria-hidden="true" href="#cb3-5" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">201</span>:  <span class="co"># Success</span></span>
<span id="cb3-6"><a aria-hidden="true" href="#cb3-6" tabindex="-1"></a>        <span class="cf">return</span> HttpResponse(<span class="st">"Created contact"</span>)</span>
<span id="cb3-7"><a aria-hidden="true" href="#cb3-7" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-8"><a aria-hidden="true" href="#cb3-8" tabindex="-1"></a>        <span class="cf">return</span> HttpResponseBadRequest(<span class="ss">f"Erreur d'inscription. Veuillez réessayer."</span>)</span></code></pre></div>
</div>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">To serve the API, it need to be linked to an url in the urls.py file of our app.</p>
<div class="code-with-filename mt-4">
<div class="code-with-filename-file bg-gray-900 inline-block text-gray-100 dark:bg-gray-200 dark:text-gray-900 py-1 px-2 -rotate-3">
<pre style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><strong>urls.py</strong></pre>
</div>
<div class="sourceCode !mt-0  overflow-auto !max-w-[40rem] bg-gray-900 dark:bg-gray-1000 text-sm lg:text-base mb-8 p-2 py-4 shadow-gray-1000 dark:shadow-gray-700 shadow-punk border border-gray-900 dark:border-gray-700" data-filename="urls.py" id="cb4"><pre class="sourceCode python code-with-copy" style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><code class="sourceCode python"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1" tabindex="-1"></a><span class="im">from</span> django.urls <span class="im">import</span> path</span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2" tabindex="-1"></a><span class="im">from</span> . <span class="im">import</span> views</span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a aria-hidden="true" href="#cb4-4" tabindex="-1"></a>urlpatterns <span class="op">=</span> [</span>
<span id="cb4-5"><a aria-hidden="true" href="#cb4-5" tabindex="-1"></a>    path(<span class="st">"create_contact"</span>, views.brevo_handler, name<span class="op">=</span><span class="st">"brevo_handler"</span>),</span>
<span id="cb4-6"><a aria-hidden="true" href="#cb4-6" tabindex="-1"></a>]</span></code></pre></div>
</div>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">You should have a working API. Sending the POST request will create a new contact in your contact list.</p>
</section>
<section class="level2" id="handling-errors">
<h2 class="text-2xl sm:text-3xl !w-full max-w-[40rem] mb-4 mt-8 font-bold text-pacific-blue-600 dark:text-pink-400" data-anchor-id="handling-errors">Handling errors</h2>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">We might want a bit more granularity in the way we deal with errors. Brevo returns a code in the response_text explaining the reason the request couldn’t go through. Here’s a few listed in the doc :</p>
<ul class="prose prose-stone dark:prose-invert !w-full max-w-[40em] mb-4 lg:max-w-[35em] marker:text-gray-700/60 dark:marker:text-gray-700/75 list-disc pl-8 lg:prose-lg">
<li><code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">invalid_parameter</code>, <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">missing_parameter</code>, <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">permission_denied</code>, <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">unauthorized</code>, <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">account_under_validation</code>, <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">not_acceptable bad_request</code>, <code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">unprocessable_entity</code> : Should all be avoided with a proper forms and a properly set up account</li>
<li><code class="p-1 text-pink-700 dark:text-pacific-blue-500 shadow-inner text-nowrap">duplicate_parameter</code>: happens when one contact is added twice, this should raise an error.</li>
</ul>
<div class="code-with-filename mt-4">
<div class="code-with-filename-file bg-gray-900 inline-block text-gray-100 dark:bg-gray-200 dark:text-gray-900 py-1 px-2 -rotate-3">
<pre style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><strong>views.py</strong></pre>
</div>
<div class="sourceCode !mt-0  overflow-auto !max-w-[40rem] bg-gray-900 dark:bg-gray-1000 text-sm lg:text-base mb-8 p-2 py-4 shadow-gray-1000 dark:shadow-gray-700 shadow-punk border border-gray-900 dark:border-gray-700" data-filename="views.py" id="cb5"><pre class="sourceCode python code-with-copy" style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><code class="sourceCode python"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> brevo_handler(request):</span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2" tabindex="-1"></a>    <span class="co">#...</span></span>
<span id="cb5-3"><a aria-hidden="true" href="#cb5-3" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">201</span>:  <span class="co"># Success</span></span>
<span id="cb5-4"><a aria-hidden="true" href="#cb5-4" tabindex="-1"></a>        <span class="cf">return</span> render(request, <span class="st">"_success_newsletter.html"</span>)</span>
<span id="cb5-5"><a aria-hidden="true" href="#cb5-5" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># Handle Brevo API errors</span></span>
<span id="cb5-6"><a aria-hidden="true" href="#cb5-6" tabindex="-1"></a>        err_code <span class="op">=</span> json.loads(response.text)[<span class="st">"code"</span>]</span>
<span id="cb5-7"><a aria-hidden="true" href="#cb5-7" tabindex="-1"></a>        <span class="cf">if</span> err_code <span class="op">==</span> <span class="st">"duplicate_parameter"</span>:</span>
<span id="cb5-8"><a aria-hidden="true" href="#cb5-8" tabindex="-1"></a>            <span class="cf">return</span> HttpResponseBadRequest(</span>
<span id="cb5-9"><a aria-hidden="true" href="#cb5-9" tabindex="-1"></a>                <span class="st">"Error : this contact is already in the database."</span></span>
<span id="cb5-10"><a aria-hidden="true" href="#cb5-10" tabindex="-1"></a>            )</span>
<span id="cb5-11"><a aria-hidden="true" href="#cb5-11" tabindex="-1"></a>        <span class="cf">return</span> HttpResponseBadRequest(</span>
<span id="cb5-12"><a aria-hidden="true" href="#cb5-12" tabindex="-1"></a>            <span class="ss">f"Inscription error </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-13"><a aria-hidden="true" href="#cb5-13" tabindex="-1"></a>        )</span></code></pre></div>
</div>
</section>
<section class="level2" id="full-code">
<h2 class="text-2xl sm:text-3xl !w-full max-w-[40rem] mb-4 mt-8 font-bold text-pacific-blue-600 dark:text-pink-400" data-anchor-id="full-code">Full code</h2>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">And here’s the full code to copy paste without thinking 😛 :</p>
<div class="cell overflow-auto  !max-w-[40rem] bg-gray-900 dark:bg-gray-1000 text-sm lg:text-base mb-8 mt-4 p-2 py-4 shadow-gray-1000 dark:shadow-gray-700 shadow-punk border border-gray-900 dark:border-gray-700" data-execution_count="2" id="8b9cad21-164f-4265-9950-2bd578c38932">
<div class="sourceCode cell-code mt-4" id="cb6"><pre class="sourceCode python code-with-copy" style=" --tw-prose-pre-code: null; --tw-prose-pre-bg: null;"><code class="sourceCode python"><span id="cb6-1"><a aria-hidden="true" href="#cb6-1" tabindex="-1"></a><span class="kw">def</span> brevo_handler(request):</span>
<span id="cb6-2"><a aria-hidden="true" href="#cb6-2" tabindex="-1"></a>    <span class="co"># Extracting the posted data from the request</span></span>
<span id="cb6-3"><a aria-hidden="true" href="#cb6-3" tabindex="-1"></a>    email <span class="op">=</span> request.POST.get(<span class="st">"email"</span>)</span>
<span id="cb6-4"><a aria-hidden="true" href="#cb6-4" tabindex="-1"></a>    last_name <span class="op">=</span> request.POST.get(<span class="st">"last_name"</span>)</span>
<span id="cb6-5"><a aria-hidden="true" href="#cb6-5" tabindex="-1"></a>    first_name <span class="op">=</span> request.POST.get(<span class="st">"first_name"</span>)</span>
<span id="cb6-6"><a aria-hidden="true" href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a aria-hidden="true" href="#cb6-7" tabindex="-1"></a>    <span class="co"># Constructing the Brevo API request payload with the posted data</span></span>
<span id="cb6-8"><a aria-hidden="true" href="#cb6-8" tabindex="-1"></a>    obj <span class="op">=</span> {</span>
<span id="cb6-9"><a aria-hidden="true" href="#cb6-9" tabindex="-1"></a>        <span class="st">"email"</span>: email,</span>
<span id="cb6-10"><a aria-hidden="true" href="#cb6-10" tabindex="-1"></a>        <span class="st">"attributes"</span>: {</span>
<span id="cb6-11"><a aria-hidden="true" href="#cb6-11" tabindex="-1"></a>            <span class="st">"NOM"</span>: last_name,</span>
<span id="cb6-12"><a aria-hidden="true" href="#cb6-12" tabindex="-1"></a>            <span class="st">"PRENOM"</span>: first_name,</span>
<span id="cb6-13"><a aria-hidden="true" href="#cb6-13" tabindex="-1"></a>        },</span>
<span id="cb6-14"><a aria-hidden="true" href="#cb6-14" tabindex="-1"></a>    }</span>
<span id="cb6-15"><a aria-hidden="true" href="#cb6-15" tabindex="-1"></a>    <span class="cf">if</span> BREVO_LIST <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb6-16"><a aria-hidden="true" href="#cb6-16" tabindex="-1"></a>        obj[<span class="st">"listIds"</span>] <span class="op">=</span> [<span class="bu">int</span>(BREVO_LIST),]</span>
<span id="cb6-17"><a aria-hidden="true" href="#cb6-17" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb6-18"><a aria-hidden="true" href="#cb6-18" tabindex="-1"></a>        <span class="st">"api-key"</span>: BREVO_API_KEY,</span>
<span id="cb6-19"><a aria-hidden="true" href="#cb6-19" tabindex="-1"></a>        <span class="st">"accept"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb6-20"><a aria-hidden="true" href="#cb6-20" tabindex="-1"></a>        <span class="st">"content-type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb6-21"><a aria-hidden="true" href="#cb6-21" tabindex="-1"></a>    }</span>
<span id="cb6-22"><a aria-hidden="true" href="#cb6-22" tabindex="-1"></a>    response <span class="op">=</span> requests.post(BREVO_URL, json<span class="op">=</span>obj, headers<span class="op">=</span>headers)</span>
<span id="cb6-23"><a aria-hidden="true" href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a aria-hidden="true" href="#cb6-24" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">201</span>:  <span class="co"># Success</span></span>
<span id="cb6-25"><a aria-hidden="true" href="#cb6-25" tabindex="-1"></a>        <span class="cf">return</span> render(request, <span class="st">"_success_newsletter.html"</span>)</span>
<span id="cb6-26"><a aria-hidden="true" href="#cb6-26" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># Handle Brevo API errors</span></span>
<span id="cb6-27"><a aria-hidden="true" href="#cb6-27" tabindex="-1"></a>        err_code <span class="op">=</span> json.loads(response.text)[<span class="st">"code"</span>]</span>
<span id="cb6-28"><a aria-hidden="true" href="#cb6-28" tabindex="-1"></a>        <span class="cf">if</span> err_code <span class="op">==</span> <span class="st">"duplicate_parameter"</span>:</span>
<span id="cb6-29"><a aria-hidden="true" href="#cb6-29" tabindex="-1"></a>            <span class="cf">return</span> HttpResponseBadRequest(</span>
<span id="cb6-30"><a aria-hidden="true" href="#cb6-30" tabindex="-1"></a>                <span class="st">"Error : this contact is already in the database."</span></span>
<span id="cb6-31"><a aria-hidden="true" href="#cb6-31" tabindex="-1"></a>            )</span>
<span id="cb6-32"><a aria-hidden="true" href="#cb6-32" tabindex="-1"></a>        <span class="cf">return</span> HttpResponseBadRequest(</span>
<span id="cb6-33"><a aria-hidden="true" href="#cb6-33" tabindex="-1"></a>            <span class="ss">f"Inscription error </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb6-34"><a aria-hidden="true" href="#cb6-34" tabindex="-1"></a>        )</span></code></pre></div>
</div>
</section>
<section class="level2" id="conclusion">
<h2 class="text-2xl sm:text-3xl !w-full max-w-[40rem] mb-4 mt-8 font-bold text-pacific-blue-600 dark:text-pink-400" data-anchor-id="conclusion">Conclusion</h2>
<p class="prose lg:prose-lg !w-full prose-stone  dark:prose-invert max-w-[40rem] mb-4">Here you go, simple indeed. Sometimes it’s easier to not use pre-made solutions. Next time we’ll make a dynamic form to uses our API.</p>
</section>

</main>
<!-- /main column -->

</div> <!-- /content -->




<script src="../js/iframe_demo.js"></script><script src="../js/ts/menu.ts"></script><script src="../js/switch_theme.js"></script></body></html>